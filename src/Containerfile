FROM quay.io/konflux-ci/yq@sha256:e0d498c054d27dbcd4740427b1a1600b5384d049ff6463812042f003c5727222 as yq

FROM quay.io/fedora/fedora@sha256:ae5eae39d9df1528dc8a6dca806075f93640834b89df2f3d9cf3a35f02968bde

COPY --from=yq /usr/bin/yq /usr/bin/yq

RUN dnf -y install tox git ruby gcc python-flake8 python-isort black yamllint pytest; dnf clean all

COPY requirements.txt requirements-build.txt ./

RUN pip install -r requirements-build.txt -r requirements.txt


# Because Cachi2 doesn't support ruby, we've got to gem install it for now
# Can look into building it from source later, although without prefetch
# not much more secure

# Currently doing the gem install is breaking syft
# Possible occurence of https://github.com/anchore/syft/issues/3194
# RUN gem install mdl

LABEL name="konflux-release-data-ci" \
    version="0.2" \
    release="1" \
    summary="Container image for running gitlab ci tasks for konflux-release-data config repo" \
    com.redhat.component="konflux-release-data-ci" \
    description="see summary :D" \
    distribution-scope="restricted" \
    url="https://github.com/release-engineering/konflux-release-data-ci/tree/main" \
    vendor="Red Hat, Inc." \
    io.k8s.display-name="konflux-release-data-ci" \
    io.k8s.description="Container image for running gitlab ci tasks for konflux-release-data config repo" \
    io.openshift.tags="oci"

ENTRYPOINT []


